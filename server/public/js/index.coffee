shapes = [
    "M 100,50 A 50,50 0 0 1 50,100 50,50 0 0 1 0,50 50,50 0 0 1 50,0 50,50 0 0 1 100,50 Z"
    "M 48.841797 0.24804688 L 36.271484 30.621094 L 2.6210938 35.894531 L 27.623047 57.236328 L 22.240234 90.867188 L 50.263672 73.683594 L 80.585938 89.197266 L 72.902344 57.236328 L 97.025391 33.191406 L 64.255859 30.621094 L 48.841797 0.24804688 z "
    "M 2.9042969 1.9472656 L 2.9042969 97.964844 L 97.035156 97.964844 L 97.035156 1.9472656 L 2.9042969 1.9472656 z "
    "M 48.912109 0.43554688 L 5.3105469 75.958984 L 92.515625 75.958984 L 48.912109 0.43554688 z "
    "M 30.082506,13.045993 C 15.494956,13.044173 3.668349,24.869029 3.6680129,39.456579 3.666192,54.045655 19.958023,66.085465 30.082506,77.876595 c 5.964666,6.946543 20.020927,18.805523 20.020927,18.805523 0,0 14.038793,-11.861353 19.99748,-18.805523 C 80.22106,66.082716 96.513319,54.044129 96.511499,39.456579 96.511162,24.870554 84.686938,13.046329 70.100913,13.045993 62.403136,13.050195 55.090287,16.412678 50.076076,22.253352 45.068985,16.42095 37.76936,13.059353 30.082506,13.045993 Z"
    "M 49.782883,1.9681779 48.409836,1.9761779 C 46.428561,1.9871779 41.901278,2.5801379 39.384446,3.1578179 35.208505,4.1163179 30.667179,5.8904079 27.009446,7.9937479 14.929304,14.940288 6.7671836,26.336538 3.8238985,40.360938 3.2253285,43.213058 3.181261,43.831368 3.175461,49.497658 3.168741,56.166078 3.404773,58.165068 4.753586,62.868748 7.0624566,70.920388 10.857263,77.473038 16.644211,83.396098 22.206438,89.089158 29.206759,93.348968 36.665696,95.581638 37.911476,95.954548 39.009509,96.268908 39.105149,96.278908 39.200789,96.288908 39.30793,86.414778 39.34343,74.337498 L 39.40788,52.378518 39.993818,51.507428 C 41.058224,49.923718 41.583233,49.754558 45.84538,49.618748 L 49.659833,49.497658 49.722333,25.732038 49.782883,1.9683579 Z M 55.501633,2.4545079 55.501633,27.649818 C 55.501633,52.626008 55.498033,52.850238 55.013352,53.649818 54.74447,54.093418 54.127403,54.707468 53.642258,55.015058 52.837452,55.525318 52.431771,55.582738 49.00554,55.657638 L 45.24968,55.739638 45.24968,76.489638 45.24968,97.239638 46.263352,97.350998 C 48.482433,97.593898 54.947612,97.276098 57.528977,96.796308 62.889615,95.799918 65.599166,94.907508 70.165696,92.640058 75.411706,90.035208 78.922928,87.450888 83.085618,83.132248 88.824908,77.177928 92.529978,70.775258 94.704758,63.048258 96.131872,57.977698 96.384352,55.970698 96.388352,49.739668 96.391352,43.907268 96.249242,42.532108 95.181321,38.157638 92.820151,28.485708 87.357056,19.572808 79.853196,13.151778 75.737406,9.6299079 69.42005,6.0217879 64.56218,4.4173979 61.859763,3.5248879 57.360381,2.4594579 56.277024,2.4564579 L 55.501633,2.4544579 Z M 40.72429,30.208418 C 43.326048,30.297718 45.842018,32.178428 46.132493,35.444748 46.348004,37.868138 45.225727,39.881648 42.987961,41.085368 40.656594,42.339448 37.242601,41.372708 35.841477,39.061928 34.839684,37.409738 34.700481,35.082518 35.50554,33.438888 36.625518,31.152298 38.700699,30.138938 40.72429,30.208418 Z M 54.361008,63.718178 C 55.216151,63.734978 56.092648,63.949148 56.929368,64.388108 61.070546,66.560608 60.900741,72.691708 56.644211,74.661538 54.051912,75.861208 50.793061,74.776868 49.484055,72.278728 48.696633,70.776008 48.521736,69.652918 48.839524,68.142008 49.417873,65.392338 51.79558,63.667678 54.361008,63.718178 Z M 81.859055,63.720178 C 86.015645,63.720178 88.654556,68.004248 86.884446,71.880328 86.239196,73.293268 84.97248,74.466398 83.65593,74.868608 80.83128,75.731508 78.010139,74.504528 76.81804,71.893998 75.042829,68.006528 77.687005,63.720178 81.859055,63.720178 Z M 68.314133,63.745578 C 70.382281,63.829278 72.411984,64.959498 73.28679,67.089328 73.778909,68.287488 73.768625,70.420738 73.26531,71.685028 72.76324,72.946198 71.123541,74.470778 69.853201,74.858858 64.924471,76.364538 60.780127,71.335888 63.111013,66.677218 64.13812,64.624378 66.24599,63.661868 68.314138,63.745578 Z"
]

canvas = null
tt = null

onShapeClick = (e)->
    changeTT(this)
    
changeTT = (e)->
    e.unmousedown()
    if tt
        subject = tt.subject 
        tt.unplug()
        subject.mousedown onShapeClick
    tt = canvas.freeTransform e, keepRatio: true 


onButtonClick = (e)=>
    p = e.data.value
    shape = canvas
        .path(p)
        .attr("fill","#FFF")
        .attr("fill-opacity",0.1)
    changeTT shape

generateButtons = ()=>
    btns = $("#buttons")
    id = 0
    w = 32
    for p in shapes
        bid = "svgbtn#{id}"
        btn = $ "<button id=\"#{bid}\" class=\"btn btn-default\" style=\"padding:0; width:#{w}px; height:#{w}px;\"></button>"
        btns.append btn
        btn.on "click", value: p, onButtonClick
        paper = Raphael bid, w, w
        shape = paper.path(p).attr("fill","#666").translate(-34,-34).scale(0.2,0.2,50,50)
        id++

$ =>
    
    generateButtons()

    paper = null
    W = H = W2 = H2 = 0

    resize = ()=>
        W = $("#raphael").width()
        H = W/2
        W2= W>>1
        H2= H>>1
        paper.setSize W, H if paper
        # paper.setSize("100%", "100%") if paper
  
    $(window).resize resize
    resize()

    canvas = Raphael("raphael", W, H)

    # rect = paper.rect(W2, H2, 50, 50).attr('fill', '#FFFFFF').attr('fill-opacity',0.5)
    # # Add freeTransform
    # ft = paper.freeTransform(rect)
    # # Hide freeTransform handles
    # ft.hideHandles()
    # # Show hidden freeTransform handles
    # ft.showHandles()
    # # Apply transformations programmatically
    # ft.attrs.rotate = 45
    # ft.apply()
    # # Remove freeTransform completely
    # ft.unplug()
    # # Add freeTransform with options and callback
    # ft = paper.freeTransform(rect, { keepRatio: true }, (ft, events) ->
    #   console.log ft.attrs
    #   return
    # )
    # # Change options on the fly
    # ft.setOpts keepRatio: false